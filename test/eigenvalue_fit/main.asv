% 
K_true = 50;
M = 10;
n_train = 200;
n_test = 500;
n_total = n_train + n_test;
shift = 0;
lambda_true = (1:K_true).^(-2);
seed = 1;
PC_dist = 'norm';
sigma2_true = 0.1; % Assume observation error

grid_pts = 0:0.02:1;
[basis_true, ~] = makeBasis(grid_pts, K_true, 0);

if (ispc)
    addpath 'D:\Documents\My Documents\Dropbox\Research\PACE_matlab\release2.16\PACE'
    addpath 'D:\Documents\My Documents\Dropbox\Research\PACE_matlab\release2.16\PACE\PACE-FAM'
%     addpath '\\stat-file.ou.ad3.ucdavis.edu\GradUsers\dai\Documents\PACE_matlab\release2.16\PACE'
%     addpath '\\stat-file.ou.ad3.ucdavis.edu\GradUsers\dai\Documents\PACE_matlab\release2.16\PACE\PACE-FAM'
end
if (isunix)
    addpath '~/PACE_matlab/release2.16/PACE'
    addpath '~/PACE_matlab/release2.16/PACE/PACE-FAM'
    % addpath '/home/dai/bayes_classification/trial'
end

rng(seed);
for (mc = 1:M)
    mc
    [Y, group] = sim_obs(n_total, 1/2, lambda_true, lambda_true, ...
        basis_true, basis_true, PC_dist, sigma2_true);
   
    dat_all = num2cell(Y, 2)';
    t_all = num2cell(ones(n_total ,1) * grid_pts, 2)';
    
    regular = 2; kernel = 'epan'; error_type = 0; rho = 0; verbose = 'off'; 
    method = 'IN'; shrink = 0; 
    out1_t = grid_pts;
    p1=setOptions('selection_k', K_max, 'regular', regular, 'method', method, 'kernel', ...
    kernel, 'numBins', 0, 'newdata', out1_t, 'error', error_type, 'screePlot', 0, ...
    'rho', rho, 'verbose', verbose);

    [mis(mc, :), K_CV(mc, :)] = misclass_cv( dat_all, t_all, group, train_ind, test_ind, K_max, ... 
        class_method, fixed_prior1, p1, fold );
    
end




